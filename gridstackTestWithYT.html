<!DOCTYPE html>
<html>
<head>
    <!--
        단위테스트
        CDN으로 구성 
        출처: http://gridstackjs.com/ 
    -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="youtube/bootstrap.min.css">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
        
<!--    <link href="http://gridstackjs.com/dist/gridstack.css" rel="stylesheet">-->
    <link href="youtube/gridstack.css" rel="stylesheet">
    <link href="youtube/demo.css" rel="stylesheet">
</head>
<body>
    <section class="darklue">
        <div class="container10">
            <div class="grid-stack" data-gs-width="12" data-gs-animate="yes">
                <div class="grid-stack-item" data-gs-x="0" data-gs-y="0" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        
                        <div id="video0"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="4" data-gs-y="0" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video1"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="8" data-gs-y="0" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video2"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="0" data-gs-y="4" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video3"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="4" data-gs-y="4" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video4"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="8" data-gs-y="4" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video5"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="0" data-gs-y="8" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video6"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="4" data-gs-y="8" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video7"></div>
                    </div>
                </div>
                <div class="grid-stack-item" data-gs-x="8" data-gs-y="8" data-gs-width="4" data-gs-height="4">
                    <div class="grid-stack-item-content">
                        <div class="myHeader"><input type="text" placeholder="videoId"/> Drag
                        <button class="rot" onclick="rotateFn(this);return false;">R</button>
                        <button class="del" onclick="deleteFn(this);return false;">X</button>
                        </div>
                        <div id="video8"></div>
                    </div>
                </div>                
            </div>
        </div>
    </section>
    
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min.js"></script>    
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.3.0/gridstack.min.js'></script>
    <script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.3.0/gridstack.jQueryUI.min.js'></script>    
-->
    <script src="youtube/jquery.min.js"></script>
    <script src="youtube/jquery-ui.min.js"></script>
    <script src="youtube/bootstrap.min.js"></script>
    <script src="youtube/lodash.min.js"></script>    
    <script type="text/javascript" src='youtube/gridstack.min.js'></script>
    <script type="text/javascript" src='youtube/gridstack.jQueryUI.min.js'></script>    
    
    <!-- youtube -->
    <script src="youtube/youtube_iframe_api.js" type="text/javascript"></script>
    
    <script type="text/javascript">
        var isFirst = true;
        var gPlayer = {};
        
        // ready
        $(function () {
            $('.grid-stack').gridstack({
                width: 12,
                alwaysShowResizeHandle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                resizable: {
                    handles: 'e, se, s, sw, w'
                }
            });
            
            setTimeout(function(){
                makePlayer(getWidtdh(4), getHeight(4), 'video0', 'aR8Fe1lTKHo', '');
                makePlayer(getWidtdh(4), getHeight(4), 'video1', '9ZpwOfKmYk8', '');
                makePlayer(getWidtdh(4), getHeight(4), 'video2', 'A9K-7AVG2i4', '');
            }, 1000);
            
            // event
            $("input").change(function(){
                var id = $(this).parent().next().attr("id");
                var player = gPlayer[id];
                if(typeof player === "undefined"){
                    makePlayer(getWidtdh(4), getHeight(4), id, $(this).val(), '');
                }else{
                    gPlayer[id].loadVideoById($(this).val());
                }
            });
            
            // event
            $('.grid-stack').on('gsresizestop', function(event, elem) {
                resizeCallback(elem);
            });            
            
            // change ui 기능 표현 샘플
            setTimeout(function(){
                var grid = $('.grid-stack').data('gridstack');
                grid.resize($("#video0").parent().parent(), 6, 6);  
                resizeCallback($("#video0").parent().parent());   // resize를 직접하면 gsresizestop event가 작동하지 않아서 따로 실행해줌
                
                $(".grid-stack-item-content").eq(2).find("button").eq(0).trigger("click");
            }, 2000);
        });
    function resizeCallback(elem){
        var newWidth = $(elem).attr('data-gs-width');
        var newHeight = $(elem).attr('data-gs-height');
        var id =  $(elem).find(".grid-stack-item-content").find("iframe").attr("id");

        console.log(newWidth);
        console.log(newHeight);
        console.log(id);
        /*
                +160 +80                
                w	  h
            1	140	  60
            2	300	  140
            3	460	  220
            4	620	  300
            5	780	  380
            6	940	  460
            7	1100  540
            8	1260  620
            9	1420  700
        */

        gPlayer[id].setSize(getWidtdh(newWidth), getHeight(newHeight));        
    }
    function makePlayer(width, height, iframeId, videoId, playlist){
        $("#" + iframeId).prev().find("input").val(videoId);
        
        var player = new YT.Player(iframeId, {
            width: width,
            height: height,
            videoId: videoId,
            playerVars: {
                playlist: playlist
                ,controls: 1
                ,cc_load_policy: 0
                ,autoplay:1
                //,fs:0
                //,showinfo:0
            },
            events: {
                onReady: onPlayerReady
                //, onPlaybackQualityChange : onPlaybackQualityChange
                //, onStateChange : onStateChange
                //, onError : onError
            }
        });
        gPlayer[iframeId] = player;
        
        // mouseover
        $("iframe#" + iframeId).mouseover(function(){
            for(videoId in gPlayer){
                // 전체 해제
                gPlayer[videoId].setVolume(0);
                $(".grid-stack-item-content").removeClass("focus");
            }
            player.setVolume(100);
            $(this).parent().addClass("focus");
        });
    }
    function onPlayerReady(event){
        if(isFirst){
            isFirst = !isFirst;
            $(".grid-stack-item-content").eq(0).addClass("focus");
            return;
        }    
        event.target.setVolume(0);
        //event.target.playVideo();
    }        
    function getWidtdh(num){
        return (num-1) * 160 + 140;
    }
    function getHeight(num){
        return (num-1) * 80 + 60;
    }
    function deleteFn(obj){
        var parent = $(obj).parent().parent().parent();     // grid-stack-item
        var id = $(obj).parent().next().attr("id");
        
        var grid = $('.grid-stack').data('gridstack');
        grid.removeWidget(parent);
        
        delete gPlayer[id];
    }
    function rotateFn(obj){
        // rotate 90 grid
        var parent = $(obj).parent().parent().parent();     // grid-stack-item
        var width = Number(parent.attr("data-gs-width"));
        var height =Number( parent.attr("data-gs-height"));
//        console.log(width);
//        console.log(height);
        
        if(height % 2 === 1){ // 홀수
            height++;
        }
        var newWidth = height / 2;
        var newHeight = width * 2;
            
        var grid = $('.grid-stack').data('gridstack');
        grid.resize(parent, newWidth, newHeight);
        
        // rotate 90 iframe(youtube)
        var iframe = $(obj).parent().parent().find("iframe");
        if(iframe.length == 1){
            var degValue = iframe.attr("degValue");
            if(typeof degValue === "undefined"){
                degValue = 90;
            }else{
                degValue = Number(degValue) + 90;
            }
            iframe.attr("degValue", degValue);
            console.log("degValue=" + degValue);
            iframe.css("transform", "rotate(" + degValue + "deg)");
            
            if(degValue % 180 == 0){
                iframe.css("left", "0px");
                iframe.css("top", "0px");
            }else{
                var ifw = parseInt(iframe.css("width")) / 2;
                var ifh = parseInt(iframe.css("height")) / 2;
                
                var gw = getWidtdh(newWidth) / 2;
                var gh = getHeight(newHeight) / 2;
                
                // iframe은 정중앙을 중심으로 회전하고, grid-stack-item은 좌측으로 크기만 조절된다.
                // --> 회전축의 이동이라 생각하고 iframe을 이동시킨다.
                var diffW = (gw-ifw);
                var diffH = (gh-ifh);
                console.log(diffW, diffH);
                iframe.css("left",  diffW + "px");
                iframe.css("top", diffH + "px");
            }
        }
        
    }
    </script>      
</body>
</html>